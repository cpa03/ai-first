name: oc - Analytics Specialist

on:
  schedule:
    - cron: '0 0 * * 5'  # Mingguan pada Jumat
  workflow_dispatch:

permissions:
  id-token: write
  contents: write
  pull-requests: write
  issues: write
  actions: write

concurrency:
  group: global
  cancel-in-progress: false

jobs:
  analytics_specialist:
    name: OC Analytics Specialist
    runs-on: ubuntu-24.04-arm
    timeout-minutes: 40
    permissions:
      id-token: write
      contents: write
      pull-requests: write
      issues: write
      actions: write
      
    env:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}
      IFLOW_API_KEY: ${{ secrets.IFLOW_API_KEY }}
      
    steps:
      - name: Checkout
        uses: actions/checkout@v5
        with:
          fetch-depth: 1
      - name: Install OpenCode CLI
        run: |
          curl -fsSL https://opencode.ai/install | bash
          echo "$HOME/.opencode/bin" >> $GITHUB_PATH
      - name: Run Analytics Specialist
        id: run_analytics_specialist
        timeout-minutes: 20
        run: |
          opencode run "$(cat <<'PROMPT'
          Bertindak sebagai AI analytics specialist yang menganalisis performa website affiliasi secara otonom. Lakukan semua tugas berikut secara langsung:

          1. Analisis traffic, conversion rates, dan affiliate earnings.
          2. Generate laporan mingguan/bulanan.
          3. Identifikasi trends dan insights.
          4. Sarankan improvements berdasarkan data.
          5. Setup atau update tracking pixels dan scripts.
          6. Monitor A/B tests untuk affiliate links.

          Gunakan analytics tools seperti Google Analytics, GH CLI, git, dan tools standar. Lakukan aksi langsung tanpa output deskripsi.
          PROMPT
          )" \
            --model iflowcn/qwen3-coder \
            --share false \